{% extends 'base.html' %}
{% load static %}

{% block title %}–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç ‚Äî {{ user.get_full_name|default:user.username }}{% endblock title %}

{% block css %}
<link href="{% static 'css/users/user.css' %}" rel="stylesheet">
{% endblock css %}

{% block content %}

<section class="dashboard">
    <div class="dashboard__container container">
        
        <!-- –•–µ–¥–µ—Ä –ø—Ä–æ—Ñ–∏–ª—è -->
        <div class="dashboard__header card">
            <div class="profile-hero">
                <div class="profile-hero__main">
                    <div class="profile-hero__avatar">
                        {% if user.profile.avatar %}
                            <img class="profile-hero__avatar-img" src="{{ user.profile.avatar.url }}" alt="–ê–≤–∞—Ç–∞—Ä">
                        {% else %}
                            <div class="profile-hero__avatar-placeholder">
                                {{ user.first_name|first|default:user.username|first|upper }}
                            </div>
                        {% endif %}
                        <div class="profile-hero__status"></div>
                    </div>
                    <div class="profile-hero__info">
                        <h1 class="profile-hero__name">{{ user.get_full_name|default:user.username }}</h1>
                        <div class="profile-hero__meta">
                            <span class="profile-hero__level">–£—Ä–æ–≤–µ–Ω—å: {{ user.study_profile.get_english_level_display|default:"-" }}</span>
                            <span class="profile-hero__streak">üî• –°–µ—Ä–∏—è: {{ user.profile.streak_days|default:"0" }} –¥–Ω–µ–π</span>
                        </div>
                        {% if not user.profile.is_verified %}
                            <div class="profile-hero__verification">
                                <span class="verification-badge verification-badge--pending">–ê–∫–∫–∞—É–Ω—Ç –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–µ</span>
                            </div>
                        {% endif %}
                    </div>
                </div>
                <div class="profile-hero__actions">
                    <a href="{% url 'users:profile-update' user.profile.id %}" class="btn btn_outline">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</a>
                </div>
            </div>
        </div>

        <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–±—É—á–µ–Ω–∏—è -->
        <div class="dashboard__stats">
            <div class="stat-card">
                <div class="stat-card__icon stat-card__icon--primary">üìö</div>
                <div class="stat-card__content">
                    <div class="stat-card__value">{{ user.profile.completed_courses|default:"0" }}</div>
                    <div class="stat-card__label">–ü—Ä–æ–π–¥–µ–Ω–æ –∫—É—Ä—Å–æ–≤</div>
                </div>
            </div>
            
            <div class="stat-card">
                <div class="stat-card__icon stat-card__icon--success">‚úÖ</div>
                <div class="stat-card__content">
                    <div class="stat-card__value">{{ user.profile.completed_lessons|default:"0" }}</div>
                    <div class="stat-card__label">–ó–∞–≤–µ—Ä—à–µ–Ω–æ —É—Ä–æ–∫–æ–≤</div>
                </div>
            </div>
            
            <div class="stat-card">
                <div class="stat-card__icon stat-card__icon--warning">‚è±Ô∏è</div>
                <div class="stat-card__content">
                    <div class="stat-card__value">{{ user.profile.study_time|default:"0" }}—á</div>
                    <div class="stat-card__label">–í—Ä–µ–º—è –æ–±—É—á–µ–Ω–∏—è</div>
                </div>
            </div>
            
            <div class="stat-card">
                <div class="stat-card__icon stat-card__icon--accent">üèÜ</div>
                <div class="stat-card__content">
                    <div class="stat-card__value">{{ user.profile.achievements|default:"0" }}</div>
                    <div class="stat-card__label">–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</div>
                </div>
            </div>
        </div>

        <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç –≤ –¥–≤–µ –∫–æ–ª–æ–Ω–∫–∏ -->
        <div class="dashboard__content">
            <!-- –õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ - –£—á–µ–±–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã -->
            <div class="dashboard__main">
                
                <!-- –¢–µ–∫—É—â–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å -->
                <div class="dashboard__section card">
                    <div class="section-header">
                        <h2 class="section-header__title">–¢–µ–∫—É—â–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å</h2>
                        <a href="/courses" class="btn btn_ghost btn_sm">–í—Å–µ –∫—É—Ä—Å—ã</a>
                    </div>
                    
                    <div class="progress-course">
                        <div class="progress-course__header">
                            <h3 class="progress-course__title">–ê–Ω–≥–ª–∏–π—Å–∫–∏–π –¥–ª—è –Ω–∞—á–∏–Ω–∞—é—â–∏—Ö</h3>
                            <span class="progress-course__percent">65%</span>
                        </div>
                        <div class="progress-course__progress">
                            <div class="progress-course__bar" style="width: 65%"></div>
                        </div>
                        <div class="progress-course__meta">
                            <span>–ü—Ä–æ–≥—Ä–µ—Å—Å: 13/20 —É—Ä–æ–∫–æ–≤</span>
                            <span>–°–ª–µ–¥—É—é—â–∏–π —É—Ä–æ–∫: –ó–∞–≤—Ç—Ä–∞</span>
                        </div>
                    </div>
                </div>

                <!-- –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç -->
                <div class="dashboard__section card">
                    <div class="section-header">
                        <h2 class="section-header__title">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –æ–±—É—á–µ–Ω–∏–µ</h2>
                    </div>
                    
                    <div class="quick-actions">
                        <a href="{% url 'assessment:start_test' %}" class="quick-action">
                            <div class="quick-action__icon">üéØ</div>
                            <div class="quick-action__content">
                                <h3 class="quick-action__title">–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —É—Ä–æ–≤–Ω—è</h3>
                                <p class="quick-action__desc">–ü—Ä–æ–π–¥–∏—Ç–µ —Ç–µ—Å—Ç –¥–ª—è —Ç–æ—á–Ω–æ–π –æ—Ü–µ–Ω–∫–∏</p>
                            </div>
                        </a>
                        
                        <a href="/courses" class="quick-action">
                            <div class="quick-action__icon">üìñ</div>
                            <div class="quick-action__content">
                                <h3 class="quick-action__title">–ù–æ–≤—ã–π —É—Ä–æ–∫</h3>
                                <p class="quick-action__desc">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç–µ –æ–±—É—á–µ–Ω–∏–µ</p>
                            </div>
                        </a>
                        
                        <a href="/practice" class="quick-action">
                            <div class="quick-action__icon">üí¨</div>
                            <div class="quick-action__content">
                                <h3 class="quick-action__title">–†–∞–∑–≥–æ–≤–æ—Ä–Ω–∞—è –ø—Ä–∞–∫—Ç–∏–∫–∞</h3>
                                <p class="quick-action__desc">–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ —Å AI-—Ä–µ–ø–µ—Ç–∏—Ç–æ—Ä–æ–º</p>
                            </div>
                        </a>
                        
                        <a href="/vocabulary" class="quick-action">
                            <div class="quick-action__icon">üìù</div>
                            <div class="quick-action__content">
                                <h3 class="quick-action__title">–ü–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ —Å–ª–æ–≤</h3>
                                <p class="quick-action__desc">15 —Å–ª–æ–≤ –∂–¥—É—Ç –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è</p>
                            </div>
                        </a>
                    </div>
                </div>

                <!-- –ü–æ—Å–ª–µ–¥–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ -->
                <div class="dashboard__section card">
                    <div class="section-header">
                        <h2 class="section-header__title">–ü–æ—Å–ª–µ–¥–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏</h2>
                    </div>
                    
                    <div class="activity-feed">
                        {% for test in user.testsession_set.all %}
                            <div class="activity-item">
                                <div class="activity-item__icon activity-item__icon--primary">üéØ</div>
                                <div class="activity-item__content">
                                    <p class="activity-item__text">
                                        <a href="{% url 'assessment:finish_view' test.id %}" class="activity-item__link">
                                            –ü—Ä–æ–π–¥–µ–Ω –≤—Å—Ç—É–ø–∏—Ç–µ–ª—å–Ω—ã–π —Ç–µ—Å—Ç –Ω–∞ —É—Ä–æ–≤–µ–Ω—å CEFR
                                        </a>
                                    </p>
                                    <span class="activity-item__time">{{ test.finished_at }}</span>
                                </div>
                                <div class="activity-item__score">+25 XP</div>
                            </div>
                        {% endfor %}
                        <div class="activity-item">
                            <div class="activity-item__icon activity-item__icon--success">‚úì</div>
                            <div class="activity-item__content">
                                <p class="activity-item__text">–ó–∞–≤–µ—Ä—à—ë–Ω —É—Ä–æ–∫ "Present Simple"</p>
                                <span class="activity-item__time">2 —á–∞—Å–∞ –Ω–∞–∑–∞–¥</span>
                            </div>
                            <div class="activity-item__score">+10 XP</div>
                        </div>
                        
                        <div class="activity-item">
                            <div class="activity-item__icon activity-item__icon--accent">üèÜ</div>
                            <div class="activity-item__content">
                                <p class="activity-item__text">–ü–æ–ª—É—á–µ–Ω–æ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ "–ù–µ–¥–µ–ª—è –æ–±—É—á–µ–Ω–∏—è"</p>
                                <span class="activity-item__time">3 –¥–Ω—è –Ω–∞–∑–∞–¥</span>
                            </div>
                        </div>
                    </div>
                </div>

                 <!-- –ü—Ä–µ–¥—Å—Ç–æ—è—â–∏–µ –¥–µ–¥–ª–∞–π–Ω—ã -->
                <div class="dashboard__section card">
                    <div class="section-header">
                        <h2 class="section-header__title">–ë–ª–∏–∂–∞–π—à–∏–µ –∑–∞–¥–∞—á–∏</h2>
                    </div>
                    
                    <div class="deadlines">
                        <div class="deadline-item">
                            <div class="deadline-item__date">
                                <span class="deadline-item__day">15</span>
                                <span class="deadline-item__month">–î–µ–∫</span>
                            </div>
                            <div class="deadline-item__content">
                                <h3 class="deadline-item__title">–î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ</h3>
                                <p class="deadline-item__desc">–£—Ä–æ–∫ 5: –í—Ä–µ–º–µ–Ω–∞ –≥—Ä—É–ø–ø—ã Perfect</p>
                            </div>
                        </div>
                        
                        <div class="deadline-item">
                            <div class="deadline-item__date">
                                <span class="deadline-item__day">18</span>
                                <span class="deadline-item__month">–î–µ–∫</span>
                            </div>
                            <div class="deadline-item__content">
                                <h3 class="deadline-item__title">–ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–π —Ç–µ—Å—Ç</h3>
                                <p class="deadline-item__desc">–ú–æ–¥—É–ª—å 3: –ì—Ä–∞–º–º–∞—Ç–∏–∫–∞</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –æ—Ç AI -->
                <div class="dashboard__section card">
                    <div class="section-header">
                        <h2 class="section-header__title">–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ AI</h2>
                    </div>
                    
                    <div class="ai-recommendations">
                        <div class="ai-recommendation">
                            <div class="ai-recommendation__icon">üí°</div>
                            <div class="ai-recommendation__content">
                                <p class="ai-recommendation__text">–°–æ—Å—Ä–µ–¥–æ—Ç–æ—á—å—Ç–µ—Å—å –Ω–∞ –≤—Ä–µ–º–µ–Ω–∞—Ö –≥—Ä—É–ø–ø—ã Continuous –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤</p>
                            </div>
                        </div>
                        
                        <div class="ai-recommendation">
                            <div class="ai-recommendation__icon">üéØ</div>
                            <div class="ai-recommendation__content">
                                <p class="ai-recommendation__text">–ü–æ–ø—Ä–∞–∫—Ç–∏–∫—É–π—Ç–µ 10 –Ω–æ–≤—ã—Ö —Å–ª–æ–≤ –∏–∑ —Ç–µ–º—ã "–ü—É—Ç–µ—à–µ—Å—Ç–≤–∏—è"</p>
                            </div>
                        </div>
                    </div>
                </div>

                
            </div>

            <!-- –ü—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ - –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
            <div class="dashboard__sidebar">
                
                <!-- Telegram –ø—Ä–æ—Ñ–∏–ª—å (–ø–µ—Ä–µ–º–µ—â–µ–Ω –ø–µ—Ä–≤—ã–π) -->
                <div class="dashboard__section card">
                    <div class="section-header">
                        <h2 class="section-header__title">Telegram –ø—Ä–æ—Ñ–∏–ª—å</h2>
                    </div>
                    
                    <div class="telegram-profile">
                        {% if user.telegram_profile.telegram_id %}
                            <!-- –ï—Å–ª–∏ –ø—Ä–æ—Ñ–∏–ª—å –ø—Ä–∏–≤—è–∑–∞–Ω -->
                            <div class="telegram-connected">
                                <div class="telegram-connected__header">
                                    <div class="telegram-connected__icon">üì±</div>
                                    <div class="telegram-connected__status">
                                        <span class="telegram-status-badge telegram-status-badge--connected">–ü–æ–¥–∫–ª—é—á–µ–Ω</span>
                                    </div>
                                </div>
                                
                                <div class="telegram-connected__info">
                                    <div class="telegram-info-item">
                                        <span class="telegram-info-item__label">Telegram ID:</span>
                                        <span class="telegram-info-item__value">{{ user.telegram_profile.telegram_id }}</span>
                                    </div>
                                    {% if user.telegram_profile.username %}
                                    <div class="telegram-info-item">
                                        <span class="telegram-info-item__label">Username:</span>
                                        <span class="telegram-info-item__value">@{{ user.telegram_profile.username }}</span>
                                    </div>
                                    {% endif %}
                                    <div class="telegram-info-item">
                                        <span class="telegram-info-item__label">–ü–æ–¥–∫–ª—é—á–µ–Ω:</span>
                                        <span class="telegram-info-item__value">{{ user.telegram_profile.created_at|date:"d.m.Y" }}</span>
                                    </div>
                                </div>
                                
                                <div class="telegram-connected__benefits">
                                    <h4 class="telegram-benefits__title">–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:</h4>
                                    <ul class="telegram-benefits__list">
                                        <li class="telegram-benefits__item">‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–æ–≤—ã—Ö —É—Ä–æ–∫–∞—Ö</li>
                                        <li class="telegram-benefits__item">‚úÖ –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –æ –∑–∞–Ω—è—Ç–∏—è—Ö</li>
                                        <li class="telegram-benefits__item">‚úÖ –ë—ã—Å—Ç—Ä—ã–π –¥–æ—Å—Ç—É–ø –∫ –±–æ—Ç—É</li>
                                    </ul>
                                </div>
                            </div>
                        {% else %}
                            <!-- –ï—Å–ª–∏ –ø—Ä–æ—Ñ–∏–ª—å –Ω–µ –ø—Ä–∏–≤—è–∑–∞–Ω -->
                            <div class="telegram-connect">
                                <div class="telegram-connect__header">
                                    <div class="telegram-connect__icon">üîó</div>
                                    <h3 class="telegram-connect__title">–ü—Ä–∏–≤—è–∂–∏—Ç–µ Telegram</h3>
                                </div>
                                
                                <p class="telegram-connect__description">
                                    –ü–æ–¥–∫–ª—é—á–∏—Ç–µ Telegram –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∏ –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ –æ–±—É—á–µ–Ω–∏—é
                                </p>
                                
                                {% if invite_link and invite_qr %}
                                <div class="telegram-connect__methods">
                                    <div class="telegram-method">
                                        <h4 class="telegram-method__title">–°–ø–æ—Å–æ–± 1: QR-–∫–æ–¥</h4>
                                        <div class="telegram-qr">
                                            <img src="{{ invite_qr }}" alt="QR-–∫–æ–¥ –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è Telegram" class="telegram-qr__image">
                                        </div>
                                        <p class="telegram-method__hint">
                                            –û—Ç—Å–∫–∞–Ω–∏—Ä—É–π—Ç–µ –∫–æ–¥ –≤ Telegram
                                        </p>
                                    </div>
                                    
                                    <div class="telegram-method">
                                        <h4 class="telegram-method__title">–°–ø–æ—Å–æ–± 2: –°—Å—ã–ª–∫–∞</h4>
                                        <div class="telegram-link">
                                            <a href="{{ invite_link }}" target="_blank" class="btn btn_primary btn_sm telegram-link__btn">
                                                <span class="btn__icon">‚úàÔ∏è</span>
                                                –ü–µ—Ä–µ–π—Ç–∏ –≤ –±–æ—Ç–∞
                                            </a>
                                        </div>
                                        <p class="telegram-method__hint">
                                            –ù–∞–∂–º–∏—Ç–µ –≤ –º–µ–Ω—é –±–æ—Ç–∞ –∫–æ–º–∞–Ω–¥—É "–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è" –∏ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –µ–º—É —ç—Ç–æ—Ç –∫–æ–¥ {{ user.telegram_profile.invite_code }}
                                        </p>
                                    </div>
                                </div>
                                {% endif %}
                                
                                <div class="telegram-connect__features">
                                    <h4 class="telegram-features__title">–ß—Ç–æ –≤—ã –ø–æ–ª—É—á–∏—Ç–µ:</h4>
                                    <ul class="telegram-features__list">
                                        <li class="telegram-features__item">üéØ –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è</li>
                                        <li class="telegram-features__item">üìö –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–æ–≤—ã—Ö —É—Ä–æ–∫–∞—Ö</li>
                                        <li class="telegram-features__item">üèÜ –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞</li>
                                        <li class="telegram-features__item">üí¨ –ë—ã—Å—Ç—Ä–∞—è —Å–≤—è–∑—å —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π</li>
                                    </ul>
                                </div>
                            </div>
                        {% endif %}
                    </div>
                </div>

               

                <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–æ—Ñ–∏–ª–µ -->
                <div class="dashboard__section card">
                    <div class="section-header">
                        <h2 class="section-header__title">–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h2>
                    </div>
                    
                    <div class="profile-info">
                        <dl class="info-list">
                            {% comment %} <div class="info-item">
                                <dt class="info-item__label">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</dt>
                                <dd class="info-item__value">{{ user.username }}</dd>
                            </div> {% endcomment %}
                            <div class="info-item">
                                <dt class="info-item__label">–≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è –ø–æ—á—Ç–∞</dt>
                                <dd class="info-item__value">{{ user.email }}</dd>
                            </div>
                            <div class="info-item">
                                <dt class="info-item__label">–¢–µ–ª–µ—Ñ–æ–Ω</dt>
                                <dd class="info-item__value">{{ user.profile.phone|default:"–ù–µ —É–∫–∞–∑–∞–Ω" }}</dd>
                            </div>
                            <div class="info-item">
                                <dt class="info-item__label">–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è</dt>
                                <dd class="info-item__value">{{ user.profile.birthdate|default:"–ù–µ —É–∫–∞–∑–∞–Ω–∞" }}</dd>
                            </div>
                        </dl>
                    </div>
                </div>

                <!-- –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è -->
                <div class="dashboard__section card">
                    <div class="section-header">
                        <h2 class="section-header__title">–ü–æ—Å–ª–µ–¥–Ω–∏–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è</h2>
                        <a href="/achievements" class="btn btn_ghost btn_sm">–í—Å–µ</a>
                    </div>
                    
                    <div class="achievements-preview">
                        <div class="achievement-badge">
                            <div class="achievement-badge__icon">üî•</div>
                            <div class="achievement-badge__info">
                                <h4 class="achievement-badge__title">7 –¥–Ω–µ–π –ø–æ–¥—Ä—è–¥</h4>
                                <p class="achievement-badge__desc">–ù–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ</p>
                            </div>
                        </div>
                        
                        <div class="achievement-badge">
                            <div class="achievement-badge__icon">üìö</div>
                            <div class="achievement-badge__info">
                                <h4 class="achievement-badge__title">–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç</h4>
                                <p class="achievement-badge__desc">5 —É—Ä–æ–∫–æ–≤ –∑–∞ –Ω–µ–¥–µ–ª—é</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

{% endblock content %}